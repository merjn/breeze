!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).BbobParser={})}(this,(function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}var r=n((function(t,e){e.__esModule=!0,e.BACKSLASH=e.PLACEHOLDER_SPACE=e.PLACEHOLDER_SPACE_TAB=e.SLASH=e.CLOSE_BRAKET=e.OPEN_BRAKET=e.SPACE=e.QUOTEMARK=e.EQ=e.TAB=e.R=e.F=e.N=void 0;e.N="\n";e.TAB="\t";e.F="\f";e.R="\r";e.EQ="=";e.QUOTEMARK='"';e.SPACE=" ";e.OPEN_BRAKET="[";e.CLOSE_BRAKET="]";e.SLASH="/";e.BACKSLASH="\\";e.PLACEHOLDER_SPACE_TAB="    ";e.PLACEHOLDER_SPACE=" "}));e(r);var o=r.BACKSLASH,i=r.SLASH,u=r.CLOSE_BRAKET,a=r.OPEN_BRAKET,s=r.SPACE,c=r.QUOTEMARK,f=r.EQ,l=r.TAB,g=r.N,p=n((function(t,e){e.__esModule=!0,e.isEOL=e.isStringNode=e.isTagNode=e.getUniqAttr=e.getNodeLength=e.escapeHTML=e.appendToNode=e.attrValue=e.attrsToString=void 0;var n=function(t){return"object"==typeof t&&!!t.tag};e.isTagNode=n;var o=function(t){return"string"==typeof t};e.isStringNode=o;e.isEOL=function(t){return t===r.N};e.getNodeLength=function t(e){return n(e)?e.content.reduce((function(e,n){return e+t(n)}),0):o(e)?e.length:0};e.appendToNode=function(t,e){t.content.push(e)};var i=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/(javascript):/gi,"$1%3A")};e.escapeHTML=i;var u=function(t,e){var n=typeof e,r={boolean:function(){return e?""+t:""},number:function(){return t+'="'+e+'"'},string:function(){return t+'="'+i(e)+'"'},object:function(){return t+'="'+i(JSON.stringify(e))+'"'}};return r[n]?r[n]():""};e.attrValue=u;e.attrsToString=function(t){return void 0===t?"":Object.keys(t).reduce((function(e,n){return[].concat(e,[u(n,t[n])])}),[""]).join(" ")};e.getUniqAttr=function(t){return Object.keys(t).reduce((function(e,n){return t[n]===n?t[n]:null}),null)}}));e(p);var d=n((function(t,e){function n(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(){return(o=Object.assign||function(t){for(var e=1;arguments.length>e;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}e.__esModule=!0,e.default=e.TagNode=void 0;var i=function(){function t(t,e,n){this.tag=t,this.attrs=e,this.content=[].concat(n)}var e,i,u,a=t.prototype;return a.attr=function(t,e){return void 0!==e&&(this.attrs[t]=e),this.attrs[t]},a.append=function(t){return(0,p.appendToNode)(this,t)},a.toTagNode=function(){return new t(this.tag.toLowerCase(),this.attrs,this.content)},a.toString=function(){var t=r.OPEN_BRAKET,e=r.CLOSE_BRAKET,n=0===this.content.length,i=this.content.reduce((function(t,e){return t+""+e}),""),u=function(t,e){var n=(0,p.getUniqAttr)(e);if(n){var r=(0,p.attrValue)(t,n),i=o({},e);return delete i[n],""+r+(0,p.attrsToString)(i)}return""+t+(0,p.attrsToString)(e)}(this.tag,this.attrs);return n?""+t+u+e:""+t+u+e+i+t+r.SLASH+this.tag+e},e=t,(i=[{key:"length",get:function(){return(0,p.getNodeLength)(this)}}])&&n(e.prototype,i),u&&n(e,u),t}();e.TagNode=i,i.create=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n=[]),new i(t,e,n)},i.isOf=function(t,e){return t.tag===e},e.default=i})),h=e(d),v=d.TagNode,A=n((function(t,e){e.__esModule=!0,e.BACKSLASH=e.PLACEHOLDER_SPACE=e.PLACEHOLDER_SPACE_TAB=e.SLASH=e.CLOSE_BRAKET=e.OPEN_BRAKET=e.SPACE=e.QUOTEMARK=e.EQ=e.TAB=e.R=e.F=e.N=void 0;e.N="\n";e.TAB="\t";e.F="\f";e.R="\r";e.EQ="=";e.QUOTEMARK='"';e.SPACE=" ";e.OPEN_BRAKET="[";e.CLOSE_BRAKET="]";e.SLASH="/";e.BACKSLASH="\\";e.PLACEHOLDER_SPACE_TAB="    ";e.PLACEHOLDER_SPACE=" "}));e(A);var T=n((function(t,e){e.__esModule=!0,e.isEOL=e.isStringNode=e.isTagNode=e.getUniqAttr=e.getNodeLength=e.escapeHTML=e.appendToNode=e.attrValue=e.attrsToString=void 0;var n=function(t){return"object"==typeof t&&!!t.tag};e.isTagNode=n;var r=function(t){return"string"==typeof t};e.isStringNode=r;e.isEOL=function(t){return t===A.N};e.getNodeLength=function t(e){return n(e)?e.content.reduce((function(e,n){return e+t(n)}),0):r(e)?e.length:0};e.appendToNode=function(t,e){t.content.push(e)};var o=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/(javascript):/gi,"$1%3A")};e.escapeHTML=o;var i=function(t,e){var n=typeof e,r={boolean:function(){return e?""+t:""},number:function(){return t+'="'+e+'"'},string:function(){return t+'="'+o(e)+'"'},object:function(){return t+'="'+o(JSON.stringify(e))+'"'}};return r[n]?r[n]():""};e.attrValue=i;e.attrsToString=function(t){return void 0===t?"":Object.keys(t).reduce((function(e,n){return[].concat(e,[i(n,t[n])])}),[""]).join(" ")};e.getUniqAttr=function(t){return Object.keys(t).reduce((function(e,n){return t[n]===n?t[n]:null}),null)}}));e(T);var E=T.isTagNode,L=function(t){return t&&void 0!==t.value?t.value:""},S=function(t){return L(t).charCodeAt(0)===i.charCodeAt(0)},N=function(){function t(t,e,n,r){this.type=t+"",this.value=e+"",this.line=Number(n),this.row=Number(r)}var e=t.prototype;return e.isEmpty=function(){return!!this.type},e.isText=function(){return!(!(t=this)||void 0===t.type||"space"!==t.type&&"new-line"!==t.type&&"word"!==t.type);var t},e.isTag=function(){return!(!(t=this)||void 0===t.type)&&"tag"===t.type;var t},e.isAttrName=function(){return!(!(t=this)||void 0===t.type)&&"attr-name"===t.type;var t},e.isAttrValue=function(){return!(!(t=this)||void 0===t.type)&&"attr-value"===t.type;var t},e.isStart=function(){return!S(this)},e.isEnd=function(){return S(this)},e.getName=function(){return e=L(t=this),S(t)?e.slice(1):e;var t,e},e.getValue=function(){return L(this)},e.getLine=function(){return(t=this)&&t.line||0;var t},e.getColumn=function(){return(t=this)&&t.row||0;var t},e.toString=function(){return t=a,t+=L(this),t+=u;var t},t}(),y=function(t,e){var n={pos:0,length:t.length},r=function(){n.pos+=1,e&&e.onSkip&&e.onSkip()},o=function(){return n.length>n.pos},i=function(){return t.substr(n.pos)},u=function(){return t[n.pos]};return{skip:r,hasNext:o,isLast:function(){return n.pos===n.length},grabWhile:function(e){var i=0;if(o())for(i=n.pos;o()&&e(u());)r();return t.substr(i,n.pos-i)},getNext:function(){var e=n.pos+1;return e>t.length-1?null:t[e]},getPrev:function(){var e=n.pos-1;return void 0!==t[e]?t[e]:null},getCurr:u,getRest:i,substrUntilChar:function(t){var e=i(),n=e.indexOf(t);return 0>n?"":e.substr(0,n)}}},O=function(t){void 0===t&&(t=[]);var e=t;return{getLast:function(){return Array.isArray(e)&&e.length>0&&void 0!==e[e.length-1]?e[e.length-1]:null},flushLast:function(){return!!e.length&&e.pop()},push:function(t){return e.push(t)},toArray:function(){return e}}},b=function(t,e,n,r){return void 0===n&&(n=0),void 0===r&&(r=0),new N(t,e,n,r)};function C(t,e){void 0===e&&(e={});var n=0,r=0,p=-1,d=Array(Math.floor(t.length)),h=e.openTag||a,v=e.closeTag||u,A=e.enableEscapeTags,T=[v,h,c,o,s,l,f,g,"!"],E=[h,s,l,g],L=[s,l],S=[f,s,l],N=function(t){return L.indexOf(t)>=0},O=function(t){return-1===E.indexOf(t)},C=function(t){return t===h||t===v||t===o},_=function(t){return t===o},P=function(t){e.onToken&&e.onToken(t),d[p+=1]=t},R=function(t){for(var e=null,i=!1,u=[],a=y(t),s=function(t){var n=t===f,r=N(t),u=a.getPrev(),s=a.getNext(),l=u===o;return null===e?!1===(n||r||a.isLast()):!(!i||!function(t){return S.indexOf(t)>=0}(t))||!!(t!==c||l||(i=!i)||s===f||N(s))&&!1===(n||r)},l=function(){var t=a.grabWhile(s),i=a.getCurr();if(null===e)e=t;else if(N(i)||i===c||!a.hasNext()){var f=function(t){return t.replace(o+c,c)}(function(t,e){for(;t.charAt(0)===e;)t=t.substring(1);for(;t.charAt(t.length-1)===e;)t=t.substring(0,t.length-1);return t}(t,c));u.push(b("attr-value",f,n,r))}else u.push(b("attr-name",t,n,r));a.skip()};a.hasNext();)l();return{tag:e,attrs:u}},k=y(t,{onSkip:function(){r++}}),B=function(){var t=k.getCurr(),e=k.getNext();if(t===g)k.skip(),n++,P(b("new-line",t,n,r=0));else if(N(t)){var o=k.grabWhile(N);P(b("space",o,n,r))}else if(A&&_(t)&&C(e))k.skip(),k.skip(),P(b("word",e,n,r));else if(t===h){k.skip();var u=k.substrUntilChar(v),a=0===u.length||u.indexOf(h)>=0;if(T.indexOf(e)>=0||a||k.isLast())P(b("word",t,n,r));else{var s=k.grabWhile((function(t){return t!==v}));if(k.skip(),-1===s.indexOf(f)||s[0]===i)P(b("tag",s,n,r));else{var c=R(s);P(b("tag",c.tag,n,r)),c.attrs.map(P)}}}else if(t===v)k.skip(),P(b("word",t,n,r));else if(O(t))if(A&&_(t)&&!C(e))k.skip(),P(b("word",t,n,r));else{var l=k.grabWhile((function(t){return A?O(t)&&!_(t):O(t)}));P(b("word",l,n,r))}};return{tokenize:function(){for(;k.hasNext();)B();return d.length=p+1,d},isTokenNested:function(e){var n=h+i+e.getValue();return t.indexOf(n)>-1}}}var _=function(t,e){void 0===e&&(e={});var n=e,r=null,o=O(),i=O(),u=O(),a=O(),s={},c=function(){u.flushLast()&&a.flushLast()},f=function(t){var e,r,u=(e=i.getLast())&&Array.isArray(e.content)?e.content:o.toArray();Array.isArray(u)&&(E(t)?(r=t.tag,n.onlyAllowTags&&n.onlyAllowTags.length&&0>n.onlyAllowTags.indexOf(r)?u.push(""+t):u.push(t.toTagNode())):u.push(t))},l=function(t){c();var e=h.create(t.getValue()),n=function(t){return void 0===s[t.getValue()]&&(s[t.getValue()]=r.isTokenNested(t)),s[t.getValue()]}(t);u.push(e),n?i.push(e):f(e)},g=function(t){t.isStart()&&l(t),t.isEnd()&&function(t){c();var e=i.flushLast();if(e)f(e);else if("function"==typeof n.onError){var r=t.getValue(),o=t.getLine(),u=t.getColumn();n.onError({message:"Inconsistent tag '"+r+"' on line "+o+" and column "+u,tagName:r,lineNumber:o,columnNumber:u})}}(t)},p=function(t){var e=u.getLast(),n=t.getValue(),r=!!s[t];if(e)if(t.isAttrName())a.push(n),e.attr(a.getLast(),"");else if(t.isAttrValue()){var o=a.getLast();o?(e.attr(o,n),a.flushLast()):e.attr(n,n)}else t.isText()?r?e.append(n):f(n):t.isTag()&&f(""+t);else t.isText()?f(n):t.isTag()&&f(""+t)};(r=(e.createTokenizer?e.createTokenizer:C)(t,{onToken:function(t){t.isTag()?g(t):p(t)},onlyAllowTags:n.onlyAllowTags,openTag:n.openTag,closeTag:n.closeTag,enableEscapeTags:n.enableEscapeTags})).tokenize();return o.toArray()};t.TagNode=v,t.default=_,t.parse=_,Object.defineProperty(t,"__esModule",{value:!0})}));
